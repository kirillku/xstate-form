# Динамические формы на state-машинах

## Задачи

- [x] синхронная валидация одного поля (пример - минимальная длина поля)
- [x] асинхронная валидация одного поля (пример - проверка на сервере занято ли имя пользователя) (`email:async@example.com`)
- [x] синхронная валидация всей формы, ошибка присваивается конкретному полю (пример: пароль - повторение пароля)
- [x] асинхронная валидация всей формы, ошибка присваивается конкретному полю (пример: предварительная проверка - извините, ваш тариф не позволяет создание такого количества узлов) (`email:example@example.com`)
- [x] асинхронная валидация всей формы, ошибка присваивается всей форме (`name:Error`)

## Описание / API

Библиоетка находится в папке `src/xstate-form`.

Библиотека состоит из двух частей:

1. `createFormMachine` - фабрика для создания стейт машины. Принимает `initialValues` и `onSubmit`, а так же опционально `validations` и `asyncValidations`. Значения полей и ошибки хранятся в контексте. Для каждого поля создается отдельная параллельная стейт машина.

2. `useFormMachine` - обертка чтобы работать с реактом, за основу было взято сильно упрощенное API библиотеки [formik](https://github.com/formium/formik).

## Недостатки и ограничения

- При асинхронной валидации всей формы, когда ошибка присваевается всей форме, машина переходит в `error`, не в `draft.[field].invalid` (но не знаю как было бы правильнее).
- Отсутсвует поддержка `touched` и `dirty`.

## Альтернативные варианты реализации

- На каждую ошибку делать отдельный вложенный стейт в стейт машине (как было в лекции), мне такое решение показалось избыточным, поэтому просто храню ошибки в контексте.
- Не хранить ошибки в контексте, а использовать поле [`meta`](https://xstate.js.org/docs/guides/states.html#state-meta-data) в `draft.[field].invalid`.
